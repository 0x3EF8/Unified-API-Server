<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unified API Server â€” Playground</title>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --border: #2a2a3a;
    --text: #e0e0e8;
    --text2: #8888a0;
    --accent: #6366f1;
    --accent2: #818cf8;
    --green: #22c55e;
    --red: #ef4444;
    --orange: #f59e0b;
    --radius: 10px;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  header h1 {
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  header h1 span.logo { font-size: 22px; }
  .health-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .health-badge.ok { background: rgba(34,197,94,0.15); color: var(--green); }
  .health-badge.bad { background: rgba(239,68,68,0.15); color: var(--red); }
  .health-badge .dot {
    width: 8px; height: 8px; border-radius: 50%;
    display: inline-block;
    animation: pulse 2s infinite;
  }
  .health-badge.ok .dot { background: var(--green); }
  .health-badge.bad .dot { background: var(--red); }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .container { max-width: 1100px; margin: 0 auto; padding: 24px; }

  /* â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .tabs {
    display: flex;
    gap: 4px;
    background: var(--surface);
    border-radius: var(--radius);
    padding: 4px;
    margin-bottom: 24px;
    border: 1px solid var(--border);
  }
  .tab {
    flex: 1;
    padding: 12px 16px;
    background: none;
    border: none;
    color: var(--text2);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .tab:hover { color: var(--text); background: var(--surface2); }
  .tab.active { background: var(--accent); color: white; }
  .tab .method {
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(255,255,255,0.15);
  }

  /* â”€â”€ Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .panel { display: none; }
  .panel.active { display: block; }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 16px;
  }
  .card h3 {
    font-size: 14px;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* â”€â”€ Form elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  label {
    display: block;
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 4px;
    font-weight: 500;
  }
  input, select, textarea {
    width: 100%;
    padding: 10px 12px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    font-family: inherit;
    margin-bottom: 12px;
    transition: border-color 0.2s;
  }
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--accent);
  }
  textarea { resize: vertical; min-height: 80px; }
  input[type="color"] {
    padding: 4px;
    height: 42px;
    cursor: pointer;
  }

  .row { display: grid; gap: 12px; }
  .row-2 { grid-template-columns: 1fr 1fr; }
  .row-3 { grid-template-columns: 1fr 1fr 1fr; }
  .row-4 { grid-template-columns: 1fr 1fr 1fr 1fr; }

  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  .checkbox-row input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin: 0;
    accent-color: var(--accent);
  }
  .checkbox-row label {
    margin: 0;
    font-size: 13px;
    color: var(--text);
  }

  /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent2); }
  .btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .btn-secondary {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { background: var(--border); }

  .action-row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  /* â”€â”€ Response area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .response-area {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }
  .response-header {
    padding: 12px 16px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
  }
  .status-pill {
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 700;
  }
  .status-pill.s2xx { background: rgba(34,197,94,0.15); color: var(--green); }
  .status-pill.s4xx { background: rgba(239,68,68,0.15); color: var(--red); }
  .status-pill.s5xx { background: rgba(239,68,68,0.15); color: var(--red); }
  .response-body {
    padding: 16px;
    max-height: 400px;
    overflow-y: auto;
  }
  .response-body pre {
    font-family: 'SF Mono', 'Cascadia Code', 'Consolas', monospace;
    font-size: 13px;
    line-height: 1.5;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* â”€â”€ Preview areas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .preview-container {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    padding: 24px;
    background: var(--surface2);
    border-radius: 8px;
  }
  .preview-container img {
    max-width: 100%;
    max-height: 350px;
    border-radius: 4px;
  }
  audio { width: 100%; margin-top: 12px; }

  /* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .spinner {
    width: 24px;
    height: 24px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    display: inline-block;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10,10,15,0.7);
    z-index: 200;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
  }
  .loading-overlay.active { display: flex; }
  .loading-overlay .spinner { width: 40px; height: 40px; border-width: 4px; }
  .loading-text { color: var(--text2); font-size: 14px; }

  /* â”€â”€ Headers table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .headers-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    margin-top: 12px;
  }
  .headers-table th {
    text-align: left;
    padding: 6px 10px;
    background: var(--surface2);
    color: var(--text2);
    font-weight: 600;
    border-bottom: 1px solid var(--border);
  }
  .headers-table td {
    padding: 5px 10px;
    border-bottom: 1px solid var(--border);
    font-family: 'SF Mono', 'Cascadia Code', monospace;
  }
  .headers-table td:first-child { color: var(--accent2); }

  /* â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hint { font-size: 12px; color: var(--text2); margin-top: -8px; margin-bottom: 12px; }
  .divider {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
  }
  .section-toggle {
    background: none;
    border: none;
    color: var(--accent2);
    font-size: 13px;
    cursor: pointer;
    padding: 4px 0;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .section-toggle:hover { color: var(--accent); }
  .collapsible { display: none; }
  .collapsible.open { display: block; }
  .file-info {
    background: var(--surface2);
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .file-info .name { font-weight: 600; }
  .file-info .size { color: var(--text2); }

  @media (max-width: 700px) {
    .row-2, .row-3, .row-4 { grid-template-columns: 1fr; }
    .tabs { flex-wrap: wrap; }
  }
</style>
</head>
<body>

<!-- Loading overlay -->
<div class="loading-overlay" id="loading">
  <div class="spinner"></div>
  <div class="loading-text" id="loadingText">Processing request...</div>
</div>

<!-- Header -->
<header>
  <h1><span class="logo">âš¡</span> Unified API Playground</h1>
  <div class="health-badge bad" id="healthBadge">
    <span class="dot"></span>
    <span id="healthStatus">Checking...</span>
  </div>
</header>

<div class="container">

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('tts')">
      <span class="method">POST</span> /tts
    </button>
    <button class="tab" onclick="switchTab('qr')">
      <span class="method">POST</span> /qr
    </button>
    <button class="tab" onclick="switchTab('dl')">
      <span class="method">POST</span> /unidl
    </button>
  </div>

  <!-- â•â•â•â•â•â•â• TTS Panel â•â•â•â•â•â•â• -->
  <div class="panel active" id="panel-tts">
    <div class="card">
      <h3>ğŸ™ï¸ Text-to-Speech</h3>

      <label for="tts-text">Text *</label>
      <textarea id="tts-text" placeholder="Enter text to convert to speech..." rows="3">Hello! This is the Unified API Server text-to-speech playground. You can type any text here and listen to it.</textarea>

      <div class="row row-2">
        <div>
          <label for="tts-voice">Voice</label>
          <select id="tts-voice">
            <option value="">Default (en-US-AnaNeural)</option>
            <option value="en-US-JennyNeural">Jenny (US Female)</option>
            <option value="en-US-GuyNeural">Guy (US Male)</option>
            <option value="en-US-AriaNeural">Aria (US Female)</option>
            <option value="en-US-DavisNeural">Davis (US Male)</option>
            <option value="en-GB-RyanNeural">Ryan (UK Male)</option>
            <option value="en-GB-SoniaNeural">Sonia (UK Female)</option>
            <option value="en-AU-NatashaNeural">Natasha (AU Female)</option>
            <option value="en-AU-WilliamNeural">William (AU Male)</option>
            <option value="ja-JP-NanamiNeural">Nanami (JP Female)</option>
            <option value="ko-KR-SunHiNeural">SunHi (KR Female)</option>
            <option value="zh-CN-XiaoxiaoNeural">Xiaoxiao (CN Female)</option>
            <option value="es-ES-ElviraNeural">Elvira (ES Female)</option>
            <option value="fr-FR-DeniseNeural">Denise (FR Female)</option>
            <option value="de-DE-KatjaNeural">Katja (DE Female)</option>
            <option value="pt-BR-FranciscaNeural">Francisca (BR Female)</option>
            <option value="hi-IN-SwaraNeural">Swara (IN Female)</option>
            <option value="ar-SA-ZariyahNeural">Zariyah (AR Female)</option>
          </select>
          <p class="hint">Or <a href="#" onclick="loadAllVoices(event)" style="color: var(--accent2)">load all 400+ voices</a></p>
        </div>
        <div>
          <label for="tts-rate">Rate</label>
          <select id="tts-rate">
            <option value="+0%">Normal (0%)</option>
            <option value="-50%">Very Slow (-50%)</option>
            <option value="-30%">Slow (-30%)</option>
            <option value="-10%">Slightly Slow (-10%)</option>
            <option value="+10%">Slightly Fast (+10%)</option>
            <option value="+30%">Fast (+30%)</option>
            <option value="+50%">Very Fast (+50%)</option>
            <option value="+100%">Maximum (+100%)</option>
          </select>
        </div>
      </div>

      <div class="row row-2">
        <div>
          <label for="tts-pitch">Pitch</label>
          <select id="tts-pitch">
            <option value="+0Hz">Normal (0Hz)</option>
            <option value="-20Hz">Very Low (-20Hz)</option>
            <option value="-10Hz">Low (-10Hz)</option>
            <option value="+10Hz">High (+10Hz)</option>
            <option value="+20Hz">Very High (+20Hz)</option>
          </select>
        </div>
        <div>
          <label for="tts-volume">Volume</label>
          <select id="tts-volume">
            <option value="+0%">Normal (0%)</option>
            <option value="-50%">Very Quiet (-50%)</option>
            <option value="-30%">Quiet (-30%)</option>
            <option value="+30%">Loud (+30%)</option>
            <option value="+50%">Very Loud (+50%)</option>
            <option value="+100%">Maximum (+100%)</option>
          </select>
        </div>
      </div>

      <div class="action-row">
        <button class="btn btn-primary" onclick="generateTTS()">
          â–¶ Generate Speech
        </button>
        <button class="btn btn-secondary" onclick="listVoices()">
          ğŸ“‹ List All Voices
        </button>
      </div>
    </div>

    <!-- TTS Result -->
    <div id="tts-result" style="display:none">
      <div class="card">
        <h3>ğŸ”Š Audio Output</h3>
        <audio id="tts-audio" controls></audio>
        <div style="margin-top:12px" class="action-row">
          <a id="tts-download" class="btn btn-secondary" download="speech.mp3">â¬‡ Download MP3</a>
        </div>
        <div id="tts-headers" style="margin-top:12px"></div>
      </div>
    </div>

    <div id="tts-voices-result" style="display:none">
      <div class="card">
        <h3>ğŸ“‹ Available Voices</h3>
        <div id="tts-voices-body" style="max-height:500px;overflow-y:auto"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• QR Panel â•â•â•â•â•â•â• -->
  <div class="panel" id="panel-qr">
    <div class="card">
      <h3>ğŸ“± QR Code Generator</h3>

      <div class="row row-2" style="margin-bottom:12px">
        <div class="checkbox-row">
          <input type="radio" name="qr-mode" id="qr-mode-data" checked onchange="toggleQRMode()">
          <label for="qr-mode-data">Standard QR</label>
        </div>
        <div class="checkbox-row">
          <input type="radio" name="qr-mode" id="qr-mode-wifi" onchange="toggleQRMode()">
          <label for="qr-mode-wifi">WiFi QR</label>
        </div>
      </div>

      <!-- Standard QR fields -->
      <div id="qr-standard-fields">
        <label for="qr-data">Data *</label>
        <input type="text" id="qr-data" placeholder="URL, text, or any data to encode..." value="https://github.com/0x3EF8/Unified-API-Server">
      </div>

      <!-- WiFi QR fields -->
      <div id="qr-wifi-fields" style="display:none">
        <div class="row row-2">
          <div>
            <label for="qr-ssid">Network Name (SSID) *</label>
            <input type="text" id="qr-ssid" placeholder="MyWiFiNetwork">
          </div>
          <div>
            <label for="qr-password">Password</label>
            <input type="text" id="qr-password" placeholder="Leave empty for open networks">
          </div>
        </div>
        <div class="row row-2">
          <div>
            <label for="qr-security">Security</label>
            <select id="qr-security">
              <option value="WPA">WPA/WPA2</option>
              <option value="WEP">WEP</option>
              <option value="nopass">Open (No Password)</option>
            </select>
          </div>
          <div>
            <div class="checkbox-row" style="margin-top:22px">
              <input type="checkbox" id="qr-hidden">
              <label for="qr-hidden">Hidden Network</label>
            </div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row row-4">
        <div>
          <label for="qr-format">Format</label>
          <select id="qr-format">
            <option value="png">PNG</option>
            <option value="svg">SVG</option>
            <option value="pdf">PDF</option>
            <option value="eps">EPS</option>
            <option value="txt">TXT (ASCII)</option>
          </select>
        </div>
        <div>
          <label for="qr-scale">Scale</label>
          <input type="number" id="qr-scale" value="10" min="1" max="100">
        </div>
        <div>
          <label for="qr-border">Border</label>
          <input type="number" id="qr-border" value="4" min="0">
        </div>
        <div>
          <label for="qr-ec">Error Correction</label>
          <select id="qr-ec">
            <option value="L">L (7%)</option>
            <option value="M" selected>M (15%)</option>
            <option value="Q">Q (25%)</option>
            <option value="H">H (30%)</option>
          </select>
        </div>
      </div>

      <div class="row row-3">
        <div>
          <label for="qr-dark">Dark Color</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="color" id="qr-dark-picker" value="#000000" style="width:50px;flex-shrink:0" oninput="document.getElementById('qr-dark').value=this.value">
            <input type="text" id="qr-dark" value="#000000" oninput="try{document.getElementById('qr-dark-picker').value=this.value}catch(e){}">
          </div>
        </div>
        <div>
          <label for="qr-light">Light Color</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="color" id="qr-light-picker" value="#ffffff" style="width:50px;flex-shrink:0" oninput="document.getElementById('qr-light').value=this.value">
            <input type="text" id="qr-light" value="#ffffff" oninput="try{document.getElementById('qr-light-picker').value=this.value}catch(e){}">
          </div>
        </div>
        <div>
          <label>Options</label>
          <div class="checkbox-row" style="margin-top:6px">
            <input type="checkbox" id="qr-micro">
            <label for="qr-micro">Force Micro QR</label>
          </div>
          <div class="checkbox-row">
            <input type="checkbox" id="qr-boost" checked>
            <label for="qr-boost">Boost Error Correction</label>
          </div>
        </div>
      </div>

      <div class="action-row">
        <button class="btn btn-primary" onclick="generateQR()">
          âš¡ Generate QR Code
        </button>
      </div>
    </div>

    <!-- QR Result -->
    <div id="qr-result" style="display:none">
      <div class="card">
        <h3>ğŸ“¸ QR Code Output</h3>
        <div class="preview-container" id="qr-preview"></div>
        <div style="margin-top:12px" class="action-row">
          <a id="qr-download-btn" class="btn btn-secondary" download="qrcode.png">â¬‡ Download</a>
        </div>
        <div id="qr-headers" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• Download Panel â•â•â•â•â•â•â• -->
  <div class="panel" id="panel-dl">
    <div class="card">
      <h3>ğŸ“¥ Universal Download</h3>
      <p class="hint" style="margin-bottom:16px;margin-top:-8px">Supports YouTube, Twitter/X, Reddit, Instagram, TikTok, SoundCloud, Vimeo, and 1000+ sites</p>

      <label for="dl-url">URL *</label>
      <input type="url" id="dl-url" placeholder="https://www.youtube.com/watch?v=..." value="">

      <div class="row row-3">
        <div>
          <label for="dl-quality">Quality</label>
          <select id="dl-quality">
            <option value="best">Best Available</option>
            <option value="1080p">1080p</option>
            <option value="720p" selected>720p</option>
            <option value="480p">480p</option>
            <option value="audio">Audio Only</option>
          </select>
        </div>
        <div>
          <label for="dl-audio-format">Audio Format</label>
          <select id="dl-audio-format">
            <option value="">Auto</option>
            <option value="mp3">MP3</option>
            <option value="m4a">M4A</option>
            <option value="opus">Opus</option>
            <option value="wav">WAV</option>
            <option value="vorbis">Vorbis</option>
          </select>
        </div>
        <div>
          <label for="dl-video-codec">Video Codec</label>
          <select id="dl-video-codec">
            <option value="">Auto</option>
            <option value="h264">H.264</option>
            <option value="h265">H.265</option>
            <option value="vp9">VP9</option>
            <option value="av1">AV1</option>
          </select>
        </div>
      </div>

      <div class="checkbox-row">
        <input type="checkbox" id="dl-extract-audio">
        <label for="dl-extract-audio">Extract audio only</label>
      </div>

      <!-- Advanced options (collapsed) -->
      <button class="section-toggle" onclick="toggleAdvanced()">
        <span id="adv-arrow">â–¸</span> Advanced Options
      </button>

      <div class="collapsible" id="dl-advanced">
        <div class="row row-3">
          <div>
            <label for="dl-rate-limit">Speed Limit</label>
            <input type="text" id="dl-rate-limit" placeholder="e.g. 2M">
          </div>
          <div>
            <label for="dl-proxy">Proxy</label>
            <input type="text" id="dl-proxy" placeholder="http://proxy:8080">
          </div>
          <div>
            <label for="dl-output-template">Output Template</label>
            <input type="text" id="dl-output-template" placeholder="%(title)s.%(ext)s">
          </div>
        </div>

        <div class="row row-2">
          <div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-subtitles">
              <label for="dl-subtitles">Download Subtitles</label>
            </div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-embed-subs">
              <label for="dl-embed-subs">Embed Subtitles</label>
            </div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-embed-thumb">
              <label for="dl-embed-thumb">Embed Thumbnail</label>
            </div>
          </div>
          <div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-metadata" checked>
              <label for="dl-metadata">Add Metadata</label>
            </div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-free-formats" checked>
              <label for="dl-free-formats">Prefer Free Formats</label>
            </div>
            <div class="checkbox-row">
              <input type="checkbox" id="dl-keep-video">
              <label for="dl-keep-video">Keep Video (when extracting audio)</label>
            </div>
          </div>
        </div>

        <label>Subtitle Languages (comma-separated)</label>
        <input type="text" id="dl-sub-langs" placeholder="en, es, ja">

        <div class="row row-3">
          <div>
            <label for="dl-playlist-start">Playlist Start</label>
            <input type="number" id="dl-playlist-start" placeholder="1" min="1">
          </div>
          <div>
            <label for="dl-playlist-end">Playlist End</label>
            <input type="number" id="dl-playlist-end" placeholder="All">
          </div>
          <div>
            <label for="dl-max-downloads">Max Downloads</label>
            <input type="number" id="dl-max-downloads" placeholder="Unlimited">
          </div>
        </div>
      </div>

      <div class="action-row">
        <button class="btn btn-primary" onclick="startDownload()">
          ğŸ“¥ Download
        </button>
      </div>
    </div>

    <!-- Download Result -->
    <div id="dl-result" style="display:none">
      <div class="card">
        <h3>âœ… Download Complete</h3>
        <div id="dl-file-info"></div>
        <div style="margin-top:12px" class="action-row">
          <a id="dl-download-btn" class="btn btn-primary" download>â¬‡ Save File</a>
        </div>
        <div id="dl-preview" style="margin-top:16px"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â• Response Log â•â•â•â•â•â•â• -->
  <div class="response-area" id="response-log" style="display:none;margin-top:16px">
    <div class="response-header">
      <span>Response</span>
      <span id="resp-status"></span>
    </div>
    <div class="response-body">
      <pre id="resp-body"></pre>
    </div>
  </div>

</div>

<script>
const BASE = window.location.origin;

// â”€â”€ Health check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkHealth() {
  const badge = document.getElementById('healthBadge');
  const status = document.getElementById('healthStatus');
  try {
    const r = await fetch(`${BASE}/health`);
    const d = await r.json();
    badge.className = 'health-badge ok';
    status.textContent = `${d.status} â€¢ ${d.services_loaded} services â€¢ ${formatUptime(d.uptime)}`;
  } catch {
    badge.className = 'health-badge bad';
    status.textContent = 'Offline';
  }
}
function formatUptime(s) {
  if (s < 60) return `${Math.round(s)}s`;
  if (s < 3600) return `${Math.floor(s/60)}m`;
  return `${Math.floor(s/3600)}h ${Math.floor((s%3600)/60)}m`;
}
checkHealth();
setInterval(checkHealth, 15000);

// â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  document.querySelectorAll('.tab').forEach((t, i) => {
    t.classList.toggle('active', ['tts','qr','dl'][i] === name);
  });
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(`panel-${name}`).classList.add('active');
}

// â”€â”€ Loading overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLoading(text) {
  document.getElementById('loadingText').textContent = text || 'Processing...';
  document.getElementById('loading').classList.add('active');
}
function hideLoading() {
  document.getElementById('loading').classList.remove('active');
}

// â”€â”€ Response log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResponse(status, body) {
  const log = document.getElementById('response-log');
  log.style.display = 'block';
  const cls = status < 300 ? 's2xx' : status < 500 ? 's4xx' : 's5xx';
  document.getElementById('resp-status').innerHTML =
    `<span class="status-pill ${cls}">${status}</span>`;
  document.getElementById('resp-body').textContent =
    typeof body === 'string' ? body : JSON.stringify(body, null, 2);
}

function renderHeaders(headers, containerId) {
  const keys = [...headers.entries()].filter(([k]) =>
    k.startsWith('x-') || k === 'content-type' || k === 'content-disposition'
  );
  if (!keys.length) return;
  let html = '<table class="headers-table"><tr><th>Header</th><th>Value</th></tr>';
  for (const [k, v] of keys) {
    html += `<tr><td>${k}</td><td>${v}</td></tr>`;
  }
  html += '</table>';
  document.getElementById(containerId).innerHTML = html;
}

// â”€â”€ TTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateTTS() {
  const text = document.getElementById('tts-text').value.trim();
  if (!text) { alert('Enter some text first'); return; }

  const body = { text };
  const voice = document.getElementById('tts-voice').value;
  const rate = document.getElementById('tts-rate').value;
  const pitch = document.getElementById('tts-pitch').value;
  const volume = document.getElementById('tts-volume').value;
  if (voice) body.voice = voice;
  if (rate !== '+0%') body.rate = rate;
  if (pitch !== '+0Hz') body.pitch = pitch;
  if (volume !== '+0%') body.volume = volume;

  showLoading('Generating speech...');
  try {
    const r = await fetch(`${BASE}/tts`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    if (!r.ok) {
      const err = await r.json();
      hideLoading();
      showResponse(r.status, err);
      return;
    }

    const blob = await r.blob();
    const url = URL.createObjectURL(blob);

    document.getElementById('tts-audio').src = url;
    document.getElementById('tts-download').href = url;
    document.getElementById('tts-result').style.display = 'block';
    document.getElementById('tts-voices-result').style.display = 'none';

    renderHeaders(r.headers, 'tts-headers');
    showResponse(r.status, `Audio generated: ${(blob.size / 1024).toFixed(1)} KB`);
  } catch (e) {
    showResponse(0, `Network error: ${e.message}`);
  }
  hideLoading();
}

async function listVoices() {
  showLoading('Fetching voices...');
  try {
    const r = await fetch(`${BASE}/tts`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ list_voices: true }),
    });
    const data = await r.json();
    showResponse(r.status, data);

    let html = `<p style="margin-bottom:12px;color:var(--text2)">${data.total} voices available â€” Default: <strong>${data.default}</strong></p>`;
    for (const [locale, voices] of Object.entries(data.voices).sort()) {
      html += `<div style="margin-bottom:8px"><strong style="color:var(--accent2)">${locale}</strong>`;
      html += `<span style="color:var(--text2);font-size:12px"> (${voices.length})</span>`;
      html += '<div style="margin-left:12px;font-size:13px">';
      for (const v of voices) {
        html += `<div style="padding:2px 0"><code style="color:var(--green);cursor:pointer" onclick="pickVoice('${v.name}')">${v.name}</code> â€” ${v.gender}</div>`;
      }
      html += '</div></div>';
    }

    document.getElementById('tts-voices-body').innerHTML = html;
    document.getElementById('tts-voices-result').style.display = 'block';
    document.getElementById('tts-result').style.display = 'none';
  } catch (e) {
    showResponse(0, `Network error: ${e.message}`);
  }
  hideLoading();
}

function pickVoice(name) {
  const sel = document.getElementById('tts-voice');
  // Check if option exists
  for (const opt of sel.options) {
    if (opt.value === name) { sel.value = name; return; }
  }
  // Add it
  const opt = new Option(name, name, true, true);
  sel.appendChild(opt);
}

async function loadAllVoices(e) {
  e.preventDefault();
  showLoading('Loading voices...');
  try {
    const r = await fetch(`${BASE}/tts`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ list_voices: true }),
    });
    const data = await r.json();
    const sel = document.getElementById('tts-voice');
    // Clear and rebuild
    sel.innerHTML = '<option value="">Default (en-US-AnaNeural)</option>';
    for (const [locale, voices] of Object.entries(data.voices).sort()) {
      const group = document.createElement('optgroup');
      group.label = locale;
      for (const v of voices) {
        group.appendChild(new Option(`${v.name} (${v.gender})`, v.name));
      }
      sel.appendChild(group);
    }
  } catch (e) {
    alert('Failed to load voices');
  }
  hideLoading();
}

// â”€â”€ QR Code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleQRMode() {
  const wifi = document.getElementById('qr-mode-wifi').checked;
  document.getElementById('qr-standard-fields').style.display = wifi ? 'none' : 'block';
  document.getElementById('qr-wifi-fields').style.display = wifi ? 'block' : 'none';
}

async function generateQR() {
  const wifi = document.getElementById('qr-mode-wifi').checked;
  const format = document.getElementById('qr-format').value;
  const body = {};

  if (wifi) {
    const ssid = document.getElementById('qr-ssid').value.trim();
    if (!ssid) { alert('Enter a network name'); return; }
    body.ssid = ssid;
    const pw = document.getElementById('qr-password').value;
    if (pw) body.password = pw;
    body.security = document.getElementById('qr-security').value;
    body.hidden = document.getElementById('qr-hidden').checked;
  } else {
    const data = document.getElementById('qr-data').value.trim();
    if (!data) { alert('Enter data to encode'); return; }
    body.data = data;
  }

  body.format = format;
  body.scale = parseInt(document.getElementById('qr-scale').value) || 10;
  body.border = parseInt(document.getElementById('qr-border').value) ?? 4;
  body.dark = document.getElementById('qr-dark').value || '#000000';
  body.light = document.getElementById('qr-light').value || '#ffffff';
  body.error_correction = document.getElementById('qr-ec').value;
  if (document.getElementById('qr-micro').checked) body.micro = true;
  body.boost_error = document.getElementById('qr-boost').checked;

  showLoading('Generating QR code...');
  try {
    const r = await fetch(`${BASE}/qr`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    if (!r.ok) {
      const err = await r.json();
      hideLoading();
      showResponse(r.status, err);
      return;
    }

    const blob = await r.blob();
    const url = URL.createObjectURL(blob);
    const preview = document.getElementById('qr-preview');

    if (format === 'png' || format === 'svg') {
      preview.innerHTML = `<img src="${url}" alt="QR Code">`;
    } else if (format === 'txt') {
      const text = await blob.text();
      preview.innerHTML = `<pre style="font-size:6px;line-height:6px;letter-spacing:1px;color:var(--text)">${text}</pre>`;
    } else {
      preview.innerHTML = `<div style="text-align:center;color:var(--text2)">
        <div style="font-size:48px;margin-bottom:8px">ğŸ“„</div>
        <div>${format.toUpperCase()} file generated (${(blob.size/1024).toFixed(1)} KB)</div>
      </div>`;
    }

    const ext = format;
    const dlBtn = document.getElementById('qr-download-btn');
    dlBtn.href = url;
    dlBtn.download = `qrcode.${ext}`;
    dlBtn.textContent = `â¬‡ Download .${ext}`;

    document.getElementById('qr-result').style.display = 'block';
    renderHeaders(r.headers, 'qr-headers');
    showResponse(r.status, `QR code generated: ${(blob.size/1024).toFixed(1)} KB`);
  } catch (e) {
    showResponse(0, `Network error: ${e.message}`);
  }
  hideLoading();
}

// â”€â”€ Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAdvanced() {
  const el = document.getElementById('dl-advanced');
  const arrow = document.getElementById('adv-arrow');
  el.classList.toggle('open');
  arrow.textContent = el.classList.contains('open') ? 'â–¾' : 'â–¸';
}

async function startDownload() {
  const url = document.getElementById('dl-url').value.trim();
  if (!url) { alert('Enter a URL first'); return; }

  const body = { url };
  body.quality = document.getElementById('dl-quality').value;

  const audioFmt = document.getElementById('dl-audio-format').value;
  if (audioFmt) body.audio_format = audioFmt;

  const codec = document.getElementById('dl-video-codec').value;
  if (codec) body.video_codec = codec;

  body.extract_audio = document.getElementById('dl-extract-audio').checked;
  body.add_metadata = document.getElementById('dl-metadata').checked;
  body.prefer_free_formats = document.getElementById('dl-free-formats').checked;

  // Advanced
  const rateLimit = document.getElementById('dl-rate-limit').value.trim();
  if (rateLimit) body.rate_limit = rateLimit;

  const proxy = document.getElementById('dl-proxy').value.trim();
  if (proxy) body.proxy = proxy;

  const outputTpl = document.getElementById('dl-output-template').value.trim();
  if (outputTpl) body.output_template = outputTpl;

  body.subtitles = document.getElementById('dl-subtitles').checked;
  body.embed_subtitles = document.getElementById('dl-embed-subs').checked;
  body.embed_thumbnail = document.getElementById('dl-embed-thumb').checked;
  body.keep_video = document.getElementById('dl-keep-video').checked;

  const subLangs = document.getElementById('dl-sub-langs').value.trim();
  if (subLangs) body.subtitle_langs = subLangs.split(',').map(s => s.trim()).filter(Boolean);

  const plStart = document.getElementById('dl-playlist-start').value;
  if (plStart) body.playlist_start = parseInt(plStart);

  const plEnd = document.getElementById('dl-playlist-end').value;
  if (plEnd) body.playlist_end = parseInt(plEnd);

  const maxDl = document.getElementById('dl-max-downloads').value;
  if (maxDl) body.max_downloads = parseInt(maxDl);

  showLoading('Downloading... This may take a minute for large files.');
  try {
    const r = await fetch(`${BASE}/unidl`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body),
    });

    if (!r.ok) {
      const err = await r.json();
      hideLoading();
      showResponse(r.status, err);
      return;
    }

    const blob = await r.blob();
    const blobUrl = URL.createObjectURL(blob);

    // Parse filename from Content-Disposition
    const cd = r.headers.get('content-disposition') || '';
    let filename = 'download';
    const utf8Match = cd.match(/filename\*=UTF-8''(.+)/);
    const basicMatch = cd.match(/filename="?([^";\n]+)"?/);
    if (utf8Match) {
      filename = decodeURIComponent(utf8Match[1]);
    } else if (basicMatch) {
      filename = basicMatch[1];
    }

    const ct = r.headers.get('content-type') || '';
    const isVideo = ct.startsWith('video/');
    const isAudio = ct.startsWith('audio/');
    const sizeMB = (blob.size / 1024 / 1024).toFixed(2);

    document.getElementById('dl-file-info').innerHTML = `
      <div class="file-info">
        <span class="name">${isVideo ? 'ğŸ¬' : isAudio ? 'ğŸµ' : 'ğŸ“„'} ${filename}</span>
        <span class="size">${sizeMB} MB â€¢ ${ct}</span>
      </div>
    `;

    const dlBtn = document.getElementById('dl-download-btn');
    dlBtn.href = blobUrl;
    dlBtn.download = filename;
    dlBtn.textContent = `â¬‡ Save ${filename}`;

    // Preview
    const preview = document.getElementById('dl-preview');
    if (isVideo) {
      preview.innerHTML = `<video controls style="width:100%;max-height:400px;border-radius:8px" src="${blobUrl}"></video>`;
    } else if (isAudio) {
      preview.innerHTML = `<audio controls style="width:100%" src="${blobUrl}"></audio>`;
    } else {
      preview.innerHTML = '';
    }

    document.getElementById('dl-result').style.display = 'block';
    showResponse(r.status, `Downloaded: ${filename} (${sizeMB} MB)`);
  } catch (e) {
    showResponse(0, `Network error: ${e.message}`);
  }
  hideLoading();
}
</script>
</body>
</html>
